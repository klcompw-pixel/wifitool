#!/bin/bash

# Colors for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

# Global variables
selected_interface=""
monitor_interface=""
scan_file=""
VIRTUAL_MODE=false

# Banner
show_banner() {
    clear
    echo -e "${GREEN}"
    echo "╔══════════════════════════════════════════════╗"
    echo "║           WiFi Pentesting Tool              ║"
    echo "║              (VIRTUAL MODE)                 ║"
    echo "╚══════════════════════════════════════════════╝"
    echo -e "${NC}"
    echo -e "${YELLOW}Mode: ${VIRTUAL_MODE}${NC}"
    echo -e "${RED}⚠️  VIRTUAL MODE - DEMO ONLY ⚠️${NC}"
    echo
}

# Check virtual environment
check_environment() {
    echo -e "${YELLOW}[*] Checking system environment...${NC}"
    
    # Check if running in VirtualBox
    if dmidecode -s system-product-name 2>/dev/null | grep -qi "virtualbox"; then
        echo -e "${BLUE}[+] Running in VirtualBox${NC}"
        VIRTUAL_MODE=true
    fi
    
    # Check for WiFi hardware
    if ! lsusb | grep -qi "wireless" && ! lspci | grep -qi "network"; then
        echo -e "${RED}[!] No physical WiFi hardware detected${NC}"
        VIRTUAL_MODE=true
    fi
    
    if [ "$VIRTUAL_MODE" = true ]; then
        echo -e "${YELLOW}[*] Virtual Mode Activated - Demo Features Only${NC}"
    fi
}

# Virtual scan simulation
virtual_scan() {
    echo -e "${YELLOW}[*] Starting VIRTUAL WiFi Scan...${NC}"
    echo -e "${CYAN}[*] This is a simulation for demo purposes${NC}"
    
    # Generate random networks for demo
    echo -e "${GREEN}"
    echo "╔══════════════════════════════════════════════╗"
    echo "║              VIRTUAL SCAN RESULTS            ║"
    echo "╚══════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${BLUE}"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "BSSID" "CH" "SIGNAL" "ENCRYPTION" "ESSID"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "----------------" "----" "--------" "------------" "---------------"
    
    # Demo networks
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:01" "6" "-45" "WPA2" "HomeNetwork"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:02" "11" "-52" "WPA2" "OfficeWiFi"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:03" "1" "-60" "WEP" "Cafe_Free"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:04" "9" "-48" "WPA2" "TP-Link_123"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:05" "3" "-65" "OPEN" "PublicWiFi"
    printf "%-18s %-4s %-8s %-12s %-15s\n" "AA:BB:CC:DD:EE:06" "6" "-55" "WPA3" "SecureNet"
    echo -e "${NC}"
    
    scan_file="virtual_scan_$(date +%Y%m%d_%H%M%S)"
    echo -e "${GREEN}[+] Virtual scan saved to: ${scan_file}${NC}"
}

# Virtual handshake capture
virtual_handshake() {
    echo -e "${YELLOW}[*] VIRTUAL Handshake Capture${NC}"
    
    if [ -z "$scan_file" ]; then
        virtual_scan
    fi
    
    echo -e "${CYAN}[*] Available virtual networks:${NC}"
    virtual_scan
    
    read -p "Enter target BSSID (virtual): " bssid
    read -p "Enter channel: " channel
    read -p "Output filename: " output_file
    
    echo -e "${YELLOW}[*] Starting virtual handshake capture...${NC}"
    echo -e "${GREEN}[*] Listening on virtual interface...${NC}"
    
    # Simulate capture process
    for i in {1..5}; do
        echo -e "${BLUE}[*] Scanning... ($i/5)${NC}"
        sleep 2
    done
    
    echo -e "${GREEN}[+] Virtual handshake captured!${NC}"
    echo -e "${YELLOW}[*] Saved to: ${output_file}.cap${NC}"
    
    # Create dummy file
    touch "${output_file}.cap"
}

# Virtual WPA bruteforce
virtual_bruteforce() {
    echo -e "${YELLOW}[*] VIRTUAL WPA Bruteforce${NC}"
    
    read -p "Enter handshake file (.cap): " cap_file
    
    if [ ! -f "$cap_file" ]; then
        echo -e "${RED}[!] File not found. Using demo file...${NC}"
        cap_file="demo_handshake.cap"
        touch "$cap_file"
    fi
    
    echo -e "${YELLOW}[*] Available wordlists:${NC}"
    echo "1. rockyou.txt"
    echo "2. common_passwords.txt" 
    echo "3. custom_list.txt"
    
    read -p "Select wordlist [1-3]: " wordlist_choice
    
    case $wordlist_choice in
        1) wordlist="rockyou.txt" ;;
        2) wordlist="common_passwords.txt" ;;
        3) wordlist="custom_list.txt" ;;
        *) wordlist="rockyou.txt" ;;
    esac
    
    echo -e "${GREEN}[*] Starting virtual bruteforce...${NC}"
    echo -e "${YELLOW}[*] Wordlist: $wordlist${NC}"
    
    # Simulate cracking process
    echo -e "${BLUE}[*] Loading wordlist...${NC}"
    sleep 2
    echo -e "${BLUE}[*] Testing passwords...${NC}"
    
    for i in {1..10}; do
        percent=$((i * 10))
        echo -e "${CYAN}[*] Progress: $percent% - Testing: password$i${NC}"
        sleep 1
    done
    
    echo -e "${RED}[!] Password not found in wordlist${NC}"
    echo -e "${YELLOW}[*] Try different wordlist or method${NC}"
}

# Virtual WPS crack
virtual_wps_crack() {
    echo -e "${YELLOW}[*] VIRTUAL WPS Crack${NC}"
    
    virtual_scan
    
    read -p "Enter target BSSID: " bssid
    read -p "Enter channel: " channel
    
    echo -e "${GREEN}[*] Starting virtual WPS attack...${NC}"
    echo -e "${YELLOW}[*] Target: $bssid on channel $channel${NC}"
    
    # Simulate WPS attack
    echo -e "${BLUE}[*] Scanning for WPS enabled...${NC}"
    sleep 2
    echo -e "${GREEN}[+] WPS enabled detected!${NC}"
    
    for i in {1..8}; do
        echo -e "${CYAN}[*] Trying PIN: 1234567$i${NC}"
        sleep 1
    done
    
    echo -e "${RED}[!] WPS attack failed - Try different method${NC}"
}

# Educational content
show_educational() {
    echo -e "${PURPLE}"
    echo "╔══════════════════════════════════════════════╗"
    echo "║               EDUCATIONAL CONTENT            ║"
    echo "╚══════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${YELLOW}WiFi Security Concepts:${NC}"
    echo "1. WEP - Weak encryption, easily cracked"
    echo "2. WPA - Improved security but vulnerable"
    echo "3. WPA2 - Current standard, secure with strong passwords"
    echo "4. WPA3 - Latest standard, enhanced security"
    echo ""
    echo -e "${YELLOW}Common Attack Methods:${NC}"
    echo "• Handshake capture + bruteforce"
    echo "• WPS PIN attacks"
    echo "• Evil twin attacks"
    echo "• Deauthentication attacks"
    echo ""
    echo -e "${RED}⚠️  Only test on your own networks!${NC}"
}

# Main menu for virtual mode
virtual_main_menu() {
    while true; do
        show_banner
        echo -e "${BLUE}VIRTUAL DEMO MODE - EDUCATIONAL PURPOSES${NC}"
        echo ""
        echo "1. Virtual WiFi Scan"
        echo "2. Virtual Handshake Capture"
        echo "3. Virtual WPA Bruteforce"
        echo "4. Virtual WPS Crack"
        echo "5. Educational Content"
        echo "6. Exit"
        echo ""
        
        read -p "Select option [1-6]: " choice
        
        case $choice in
            1)
                virtual_scan
                ;;
            2)
                virtual_handshake
                ;;
            3)
                virtual_bruteforce
                ;;
            4)
                virtual_wps_crack
                ;;
            5)
                show_educational
                ;;
            6)
                echo -e "${GREEN}[+] Exiting...${NC}"
                exit 0
                ;;
            *)
                echo -e "${RED}[!] Invalid option!${NC}"
                ;;
        esac
        
        echo ""
        read -p "Press Enter to continue..."
    done
}

# Check environment and start
check_environment

if [ "$VIRTUAL_MODE" = true ]; then
    virtual_main_menu
else
    echo "Hardware mode not available in this environment"
    virtual_main_menu
fi
